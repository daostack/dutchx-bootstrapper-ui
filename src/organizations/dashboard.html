<template>
  <div class="dashboard-page animated-page au-animate">
    <header network.to-view="networkName"></header>

    <banner></banner>

    <div
      ref="dashboardElement"
      class="dashboard-main-content"
    >

      <div class="dashboard-header">
        <pageloading
          if.bind="loading"
          icononly="true"
          class="main-spinner"
        ></pageloading>
        <img
          else
          class="logo"
          src="../../static/dutchx-blue.svg"
        />
        <div class="title">Welcome to the dxDAO Vote Staking Interface</div>
      </div>

      <div class="propositionsSection">
        <div class="row">
          <div class="col-md-4 proposition">
            <div class="icon"><img src="../../static/icon-better-way-to-trade.svg" /></div>

            <div class="title first">A Better Way To Trade</div>

            <div class="body">
              Governed by the dxDAO, the DutchX is a fully decentralized trading protocol that uses the Dutch auction principle to mitigate harmful trading practices like frontrunning, low liquidity, and third party risk.
            </div>
          </div>
          <div class="col-md-4 proposition">
            <div class="icon"><img src="../../static/icon-completely-decentralized.svg" /></div>

            <div class="title second">Completely Decentralized</div>

            <div class="body">The community run dxDAO gives its stakeholders, such as traders and market makers, the unique ability to govern the DutchX, allowing them to list tokens, manage fees, update the protocol, and more!</div>
          </div>
          <div class="col-md-4 proposition">
            <div class="icon"><img src="../../static/icon-holographic-governance.svg" /></div>

            <div class="title third">Holographic Governance</div>

            <div class="body">Holographic consensus helps DAOs scale, and in the case of the dxDAO, onboard important participants like traders, liquidity providers, and governance enthusiasts into its decentralized finance ecosystem.</div>
          </div>
        </div>
      </div>

      <div class="schedule-section">
        <compose view-model="../schedule/schedule"></compose>
      </div>

      <div class="initializationSection">
        <div class="row">
          <div class="col-8 offset-2">
            <div class="title">The Vote Staking Period</div>
            <div class="body">
              <div class="body">Before the dxDAO begins making decisions, there is a vote staking period. During this period, users must stake for their vote to receive voting power in the dxDAO upon launch. There are several methods of participating in the vote staking period to earn Reputation:</div>
              <div class="list-items">
                <div class="list-item"><span class="bullet">1</span>Locking ETH</div>
                <div class="list-item"><span class="bullet">2</span>Locking Tokens</div>
                <div class="list-item"><span class="bullet">3</span>Registering MGN tokens</div>
                <div class="list-item"><span class="bullet">4</span>Bidding GEN tokens</div>
                <div style="border-bottom: dashed 1px white; margin-bottom:.5rem"></div>
                <p>After Vote Staking Period</p>
                <div class="list-item"><span class="bullet">5</span>Bidding GEN tokens</div>
              </div>

              <div
                if.to-view="schemesLoaded && !canRedeem"
                class="box"
              >The vote staking period will end on ${lockingPeriodEndDate | date:'shortdate'}
                at ${lockingPeriodEndDate | date:'amPmTime'} (GMT${lockingPeriodEndDate | date:'GmtOffset'}).
                At this time, Reputation (voting power) will be automatically distributed to participants.</div>
            </div>
          </div>
        </div>
      </div>

      <div if.bind="avatarLoaded">
        <div class="schemesSection">
          <div if.bind="!schemesLoaded">
            <pageloading></pageloading>
          </div>
          <div else>
            <div
              class="row justify-content-around"
              id="accordion_arc_schemes"
              role="tablist"
              show.bind="dutchXSchemes.length"
            >
              <div
                class="col-12 col-md-4"
                style="min-width: 25rem"
              >
                <div class="body">How do you plan to stake for your vote in the dxDAO?</div>
                <ul class="list-group clean dashboard-schemes">
                  <li
                    class="list-group-item"
                    repeat.for="scheme of dutchXSchemes"
                  >
                    <div
                      class="scheme-use-button"
                      data-toggle="collapse"
                      data-target="#${scheme.name}"
                      data-scheme="${scheme.name}"
                      aria-expanded="false"
                      aria-controls="#${scheme.name}"
                    >
                      <div class="row">
                        <div
                          class="col-1"
                          style="padding-left:0;padding-right:0"
                        >
                          <div class="scheme-icon">
                            <img
                              class="not-selected"
                              src.one-time="dutchXSchemeConfigs.get(scheme.name).icon"
                            />
                            <img
                              class="selected"
                              src.one-time="dutchXSchemeConfigs.get(scheme.name).icon_hover"
                            />
                          </div>
                        </div>
                        <div
                          class="col-4"
                          style="white-space:nowrap; padding-top:.25rem;"
                        >
                          <div class="scheme-name">
                            ${scheme.friendlyName}
                          </div>
                        </div>
                        <div
                          class="col-6"
                          style="text-align:center; white-space:nowrap; padding-top: .25rem;"
                        >
                          <div
                            if.to-view="dutchXSchemeConfigs.get(scheme.name).hasActiveLocks && scheme.numLocks"
                            class="scheme-name activeLocks"
                          >${scheme.numLocks} active locks</div>
                          <div else>&nbsp;</div>
                        </div>
                        <div
                          class="col-1"
                          style="text-align:right;padding-left:0;padding-right:0"
                        >
                          <div class="scheme-name">
                            <div style="display:inline-block; width:100%; text-align: right;">
                              <div class="scheme-arrow-down"><span class="material-icons">keyboard_arrow_down</span></div>
                              <div class="scheme-arrow-up"><span class="material-icons">keyboard_arrow_up</span></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div
                      id.bind="scheme.name"
                      class="scheme-dashboard collapse"
                      data-parent="#accordion_arc_schemes"
                    >
                      <compose
                        view-model.bind="getDashboardView(scheme)"
                        model.bind="schemeDashboardViewModel(scheme)"
                      ></compose>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="col-12 col-md-5">
                <div class="pie-chart">
                  <div class="title">Vote Staking Period</div>
                  <div class="body">
                  </div>
                  <div class="chart">
                    <img src="../../static/ds_dutchx_pie_chart_01-1.svg" />
                    <div style="text-align:center">
                      <p>To participate, you can lock ETH or tokens whitelisted on the DutchX trading protocol, register Magnolia (MGN) earned by trading on the DutchX protocol, or <a
                          target="_blank"
                          href="https://medium.com/daostack/on-the-utility-of-the-gen-token-eb4f341d770e"
                        >bid GEN</a> in any of ten auctions throughout the 30 day vote staking period.</p>
                      <p>You may participate with more than one method of staking your vote, and you may bid GEN and lock ETH or tokens multiple times, with Reputation accumulating additively. You only need to register Magnolia (MGN) once, with the final amount of Magnolia registered in your wallet at the end of the vote staking period calculated toward your final Reputation award.</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="redeemSection">
          <div class="row">
            <div
              class="col-6 offset-3"
              if.to-view="!canRedeem"
            >
              <div class="title">Voting Power (Reputation) Distribution</div>
              <div class="body">
                <p>When the dxDAO vote staking period ends, the total amount of Reputation (voting power) you have earned will be transferred to the wallet address you used to participate during the vote staking period. To benefit the most from future functionality, use the <a
                    target="_blank"
                    href="https://safe.gnosis.io/"
                  >Gnosis Safe</a> to stake for your vote.</p>
              </div>
            </div>

            <div
              class="col-6 offset-3"
              if.to-view="canRedeem"
            >
              <div class="title">Voting Power (Reputation) Distribution</div>
              <div class="body">
                The dxDAO vote staking period ended on ${lockingPeriodEndDate | date:'shortdate'}
                at ${lockingPeriodEndDate | date:'amPmTime'} (GMT${lockingPeriodEndDate | date:'GmtOffset'}).
              </div>
              <div class="redeemables">
                <pageloading if.to-view="computingRedeemables">Thanks for waiting while we compute your earned reputation...</pageloading>
                <div else>
                  <div if.bind="canRedeem && totalUserReputationEarned.eq(0)">You have not earned any reputation</div>
                  <div if.bind="canRedeem && totalUserReputationEarned.gt(0)">
                    <div class="title">You Have Earned <floating-point-number
                        value.to-view="totalUserReputationEarned | ethwei"
                        precision="8"
                      ></floating-point-number>
                      (<floating-point-number
                        value.to-view="percentUserReputationEarned"
                        precision="4"
                      ></floating-point-number>%) Reputation:</div>
                    <div class="body">
                      <div class="breakdown">
                        <table class="table">
                          <thead>
                            <tr>
                              <th>Reputation</th>
                              <th>Through</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr repeat.for="redeemable of redeemables">
                              <td>
                                <floating-point-number
                                  value.to-view="redeemable.amount | ethwei"
                                  precision="8"
                                  placement="left"
                                ></floating-point-number> Rep
                              </td>
                              <td>${redeemable.what}</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div>
                        <p>All reputation earned by all participants will be distributed after the vote staking period.</p>
                        <p>Reputation is not an ERC-20 token and will not appear in most wallets. To confirm on Etherscan you’ve received Reputation, follow [this tutorial].</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <footer if.bind="avatarLoaded"></footer>
    </div>
</template>

<template>
  <div
    class="pageloader"
    if.bind="!loaded"
  >
    <pageloading></pageloading>
  </div>
  <div else>
    <instructions if.to-view="!auctionIsOver">You can receive reputation by bidding GEN tokens. There will be 10 auctions, each will run for 9 days
      and offer 10,000 REP. The DutchX DAO will receive all the GEN collected in the auctions. To participate all you
      need to do is enter the amount of GEN you wish to bid and click "Bid". The reputation will be distributed pro
      rata once the auction is complete.
    </instructions>

    <div class="scheme-dashboard-body">

      <div
        class="message"
        if.to-view="auctionNotBegun"
      >The initialization period has not yet begun, you can't bid</div>
      <div
        class="message"
        if.to-view="auctionIsOver"
      >The initialization period has ended</div>

      <div
        class="message"
        style="text-align: left"
        if.to-view="!auctionNotBegun && !auctionIsOver"
      >
        <div>Current auction: ${currentAuctionNumber} of ${auctionCount}</div>
        <div>Time left: ${msRemainingInAuctionCountdown | timespan:"seconds"}</div>
      </div>

      <form if.bind="!auctionNotBegun && !auctionIsOver">
        <div class="row">
          <div class="col-5">
            <div class="form-group bmd-form-group">
              <label for="bidAmount">Tokens to bid</label>
              <numeric-input
                css="form-control"
                id="bidAmount"
                value.bind="bidAmount | ethwei"
              ></numeric-input>
            </div>
            <div class="form-group">
              <spinbutton
                disabled.bind="bidding"
                onclick.call="bid()"
                css="btn-submit btn-sm"
                as-button="true"
                text="Bid"
                spin.to-view="bidding"
                title.to-view="bidding ? 'Submitting bid...' : 'Submit Bid'"
              ></spinbutton>
            </div>
          </div>
        </div>
      </form>

      <div style="padding-left: .5rem; padding-right: .5rem">
        <div
          class="inline"
          style="font-weight: 500;"
        >Your Bid</div>
        <div class="pull-right">
          <spinbutton
            onclick.call="refresh()"
            class="locksRefreshButton"
            spin.to-view="refreshingBids"
            title="Refresh Bids List"
          ></spinbutton>
        </div>
      </div>
      <table class="table locksForRep">
        <thead class="thead-light">
          <tr>
            <!-- <th>Lock Id</th> -->
            <th style="text-align:left;width: 20%;">Amount</th>
            <th>Of</th>
            <th>Releasable</th>
            <th>&nbsp;</th>
          </tr>
        </thead>
        <tbody>
          <tr if.to-view="_locks.length === 0">
            <td
              colspan="100"
              style="text-align: center; padding-top: 1rem"
            >
              You have not yet submitted any locks
            </td>
          </tr>
          <tr repeat.for="lock of _locks">
            <!-- <td>${lock.lockId }</td> -->
            <td>${lock.amount | ethwei}</td>
            <td>${lock.units}</td>
            <td style="white-space:nowrap">
              ${lock.releaseTime | date:lock.releasableToday ? 'table-time' : 'table-date'}</span>
              <span if.one-time="lock.releasableToday"> today</span>
            </td>
            <td style="text-align:center;">
              <button
                click.delegate="_release(lock)"
                disabled.bind="!lock.canRelease"
                if.to-view="!lock.releasing && !lock.released"
                class="btn btn-link"
              >Release</button>
              <div
                if.to-view="lock.releasing && !lock.released"
                title="Releasing"
                class="inline text-primary fa-refresh fa fa-spin"
                style="line-height: 21px"
              ></div>
              <button
                if.to-view="lock.released"
                class="btn btn-link"
                disabled
              >Completed</button>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>
</template>

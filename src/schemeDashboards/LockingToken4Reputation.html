<template>
  <div
    class="pageloader"
    if.bind="!loaded"
  >
    <pageloading></pageloading>
  </div>
  <div else>
    <instructions if.to-view="!lockingPeriodIsEnded">Select a token, the number of tokens you would like to lock and the length you wish to lock it for.
      You can lock as many tokens as you like, for up to one year.
      At the end of the initialization period, your reputation will be calculated pro rata according to the total locked tokens and the value of each token at the time of locking.</instructions>

    <div
      class="scheme-dashboard-body lockingTokens"
      ref="dashboard"
    >

      <div
        class="message"
        if.to-view="lockingPeriodHasNotStarted"
      >The initialization period has not yet begun, you can't yet lock.</div>
      <div
        class="message"
        if.to-view="lockingPeriodIsEnded"
      >The initialization period has ended.</div>

      <form
        if.to-view="inLockingPeriod"
        with.bind="lockModel"
      >
        <div class="row">
          <div class="col-12">
            <div class="form-group bmd-form-group">
              <div class="dropdown">
                <a
                  class="dropdown-toggle"
                  id="lockableTokensDdl"
                  href="#"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >${selectedToken ? "Selected token: " + selectedToken.symbol : "Select a
                  Token to Lock"}</a>
                <ul
                  class="dropdown-menu"
                  aria-labelledby="lockableTokensDdl"
                >
                  <li
                    class="dropdown-item"
                    click.delegate="selectToken.call($parent.$parent, tokenSpec)"
                    repeat.for="tokenSpec of $parent.lockableTokens"
                  >${tokenSpec.symbol} (<tokenbalance
                      token.to-view="tokenSpec.address"
                      balance.from-view="tokenSpec.balance"
                    ></tokenbalance>)
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div if.to-view="selectedToken">
          <div
            class="message"
            if.to-view="!selectedTokenIsLiquid"
          >
            At this point in time, there isn't sufficient trading for ETH/${selectedToken.symbol} on the DutchX.
            Please choose another token or try again another time. You can read more about this here: <a
              href="https://dutchx.readthedocs.io"
              target="_blank"
            >https://dutchx.readthedocs.io</a>.
          </div>
          <div else>
            <div class="row">
              <div class="col-5">
                <div class="form-group bmd-form-group">
                  <label for="lockAmount">Tokens to lock</label>
                  <numeric-input
                    css="form-control"
                    id="lockAmount"
                    value.bind="amount | ethwei"
                  ></numeric-input>
                </div>
              </div>
              <div class="col-6">
                <div class="form-group bmd-form-group">
                  <label for="lockingPeriod">Number of days</label>
                  <numeric-input
                    css="form-control"
                    id="lockingPeriod"
                    value.bind="period | secondsDays"
                  ></numeric-input>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div class="form-group">
                  <spinbutton
                    onclick.call="lock()"
                    disabled.bind="locking"
                    css="btn-submit btn-sm"
                    as-button="true"
                    text="Submit"
                    spin.to-view="locking"
                    title.to-view="locking ? 'Locking...' : 'Submit Lock'"
                  ></spinbutton>
                  <metamaskfeedback if.to-view="sending"></metamaskfeedback>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>

      <div if.to-view="locks.length">
        <locks-for-reputation
          locks.to-view="locks"
          release.call="release({lock})"
          wrapper.one-time="wrapper"
          refresh.call="getLocks()"
        ></locks-for-reputation>
      </div>
    </div>
  </div>
</template>
